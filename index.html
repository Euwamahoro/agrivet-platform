<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Architecture Diagram</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .diagram-container {
            width: 95vw;
            height: 95vh;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
        }
        
        .mermaid {
            font-size: 10px;
            font-weight: bold;
            width: 100%;
            height: 102%;
            min-width: 1400px;
        }
        
        /* Custom styling for better visibility */
        .mermaid .node rect {
            stroke-width: 3px;
            rx: 8;
            ry: 8;
        }
        
        .mermaid .node ellipse {
            stroke-width: 3px;
        }
        
        .mermaid .cluster rect {
            fill: rgba(255, 255, 255, 0.9);
            stroke: #666;
            stroke-width: 3px;
            rx: 10;
            ry: 10;
        }
        
        .mermaid .cluster-label {
            font-size: 35px;
            font-weight: bold;
            fill: #333;
        }
        
        .mermaid .edgePath .path {
            stroke: #555;
            stroke-width: 3px;
        }
        
        .mermaid .label {
            font-size: 22px;
            font-weight: bold;
        }
        
        .mermaid .node .label {
            font-size: 32px;
            font-weight: bold;
        }
        
        /* Custom color classes */
        .mermaid .client rect {
            fill: #74b9ff;
            stroke: #0984e3;
            color: white;
        }
        
        .mermaid .gateway rect {
            fill: #fd79a8;
            stroke: #e84393;
            color: white;
        }
        
        .mermaid .service rect {
            fill: #55efc4;
            stroke: #00b894;
            color: white;
        }
        
        .mermaid .data rect {
            fill: #fdcb6e;
            stroke: #e17055;
            color: white;
        }
        
        .mermaid .infra rect {
            fill: #a29bfe;
            stroke: #6c5ce7;
            color: white;
        }
    </style>
</head>
<body>
    <div class="diagram-container">
        <div class="mermaid">
graph TB
    subgraph "Client Applications Layer"
        WEB[Web Portal<br/>React.js/Vue.js]
        MOBILE[Mobile App<br/>Cross-platform]
        USSD[USSD Interface<br/>Feature Phones]
    end
    
    subgraph "API Gateway Layer"
        GATEWAY[API Gateway<br/>Routing & Load Balancing]
        AUTH[Authentication Service<br/>JWT & RBAC]
    end
    
    subgraph "Microservices Layer"
        USER[User Service<br/>Profile Management]
        AGRO[Agronomy Service<br/>Crop Advisory]
        VET[Veterinary Service<br/>Livestock Health]
        GEO[Geospatial Service<br/>Location Matching]
        MARKET[Market Linkage Service<br/>Buyer Connections]
        ANALYTICS[Analytics Service<br/>Insights & Reports]
    end
    
    subgraph "Data Layer"
        POSTGRES[(PostgreSQL + PostGIS<br/>Primary Database)]
        REDIS[(Redis Cache<br/>Session & Caching)]
        FILES[File Storage<br/>Images & Documents]
        QUEUE[Message Queue<br/>Async Processing]
    end
    
    subgraph "Infrastructure Layer"
        DOCKER[Docker Containers<br/>Service Packaging]
        K8S[Kubernetes<br/>Orchestration]
        CLOUD[Cloud Infrastructure<br/>AWS/GCP/Azure]
    end
    
    %% Connections
    WEB --> GATEWAY
    MOBILE --> GATEWAY
    USSD --> GATEWAY
    
    GATEWAY --> AUTH
    GATEWAY --> USER
    GATEWAY --> AGRO
    GATEWAY --> VET
    GATEWAY --> GEO
    GATEWAY --> MARKET
    GATEWAY --> ANALYTICS
    
    USER --> POSTGRES
    AGRO --> POSTGRES
    VET --> POSTGRES
    GEO --> POSTGRES
    MARKET --> POSTGRES
    ANALYTICS --> POSTGRES
    
    USER --> REDIS
    AGRO --> REDIS
    VET --> FILES
    MARKET --> QUEUE
    
    USER --> DOCKER
    AGRO --> DOCKER
    VET --> DOCKER
    GEO --> DOCKER
    MARKET --> DOCKER
    ANALYTICS --> DOCKER
    
    DOCKER --> K8S
    K8S --> CLOUD
    
    %% Styling
    class WEB,MOBILE,USSD client
    class GATEWAY,AUTH gateway
    class USER,AGRO,VET,GEO,MARKET,ANALYTICS service
    class POSTGRES,REDIS,FILES,QUEUE data
    class DOCKER,K8S,CLOUD infra
        </div>
    </div>

    <script>
        // Initialize Mermaid with optimized settings for large text
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: false,
                htmlLabels: true,
                curve: 'basis',
                rankSpacing: 100,
                nodeSpacing: 50,
                rankDir: 'TB'
            },
            securityLevel: 'loose'
        });
        
        // Force a redraw on window resize
        window.addEventListener('resize', function() {
            mermaid.init(undefined, document.querySelectorAll('.mermaid'));
        });
    </script>
</body>
</html>